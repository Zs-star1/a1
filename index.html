<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ØªÙÙˆÙ‚ ğŸ¤– | Ø±ÙˆØ¨ÙˆØª ØµÙ Ø£ÙˆÙ„ + Ù†Ù‚Ø§Ø· ÙˆÙ…ÙƒØ§ÙØ¢Øª ÙˆØ£Ù„Ø¹Ø§Ø¨</title>
<style>
  :root{
    --green-25:#f3faf4;
    --green-50:#e8f5e9;
    --green-100:#dff5e3;
    --green-200:#c8ebcf;
    --green-300:#a9dfb6;
    --green-400:#81c784;
    --green-600:#2e7d32;
    --text:#0b3d2c;
    --white:#fff;
    --shadow:0 10px 30px rgba(0,0,0,.07);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: "Tajawal", system-ui, -apple-system, Segoe UI, Arial;
    background: linear-gradient(180deg,var(--green-25),var(--green-50));
    color:var(--text);
  }
  header{
    position:sticky; top:0; z-index:10;
    background: linear-gradient(90deg,var(--green-300),var(--green-100));
    box-shadow:var(--shadow);
    padding:12px 16px;
  }
  .wrap{max-width:1150px;margin:0 auto;padding:16px}
  .brand{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .brand .badge{
    background:var(--white); color:var(--green-600); font-weight:700;
    padding:6px 10px; border-radius:999px; box-shadow:var(--shadow); font-size:.9rem
  }
  h1{margin:0; font-size:1.4rem}

  main .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:18px;}
  @media (max-width:980px){ main .grid{grid-template-columns:1fr} }

  .card{
    background:var(--white); border-radius:18px; padding:18px; box-shadow:var(--shadow);
  }

  /* Ø§Ù„Ø±ÙˆØ¨ÙˆØª */
  .bot{display:flex; gap:18px; align-items:center; flex-wrap:wrap;}
  .bot-avatar{
    width:120px; height:120px; border-radius:50%;
    background: radial-gradient(circle at 35% 35%, #b7f4c7, #7adf98);
    display:grid; place-items:center; box-shadow:var(--shadow);
  }
  .bot-avatar svg{width:70%; height:70%}
  .bubble{
    flex:1; background:var(--green-25); border:2px dashed var(--green-300);
    border-radius:16px; padding:14px; line-height:1.9
  }
  .bubble b{color:var(--green-600)}

  .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
  button{
    border:0; border-radius:12px; padding:10px 14px; cursor:pointer;
    background:var(--green-300); color:var(--text); font-weight:700;
    box-shadow:var(--shadow); transition:transform .1s ease, filter .2s ease
  }
  button:hover{transform: translateY(-2px)}
  button.secondary{background:var(--green-100)}
  button.ghost{background:var(--white); border:2px solid var(--green-300)}
  button.warn{background:#ffe6e6; border:2px solid #ffb3b3}

  /* Ø§Ù„Ù†Ù‚Ø§Ø· */
  .score{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    background:var(--green-25); border:2px solid var(--green-100);
    border-radius:14px; padding:12px; margin-top:12px
  }
  .pts{font-size:1.15rem; font-weight:800; color:var(--green-600)}
  .progress{height:10px; background:var(--green-100); border-radius:999px; overflow:hidden; flex:1}
  .bar{height:100%; width:0%; background:linear-gradient(90deg,#81c784,#4caf50)}

  .rewards{
    display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; margin-top:14px
  }
  @media (max-width:600px){.rewards{grid-template-columns:1fr}}
  .reward{
    background:var(--green-25); border:1px solid var(--green-100);
    border-radius:12px; padding:10px
  }
  .reward.locked{opacity:.55; filter:grayscale(.3)}
  .reward .title{font-weight:800}
  .reward .need{font-size:.9rem}

  /* Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹ */
  .quiz{
    background:var(--white); border:2px solid var(--green-100); border-radius:14px; padding:14px; margin-top:14px;
  }
  .quiz h3{margin:0 0 8px}
  .choices{display:grid; gap:8px; margin-top:8px}
  .choice{
    background:var(--green-25); border:1px solid var(--green-100); border-radius:10px;
    padding:10px; cursor:pointer; transition:transform .08s ease
  }
  .choice:hover{transform:translateY(-2px)}
  .choice.correct{border-color:#43a047}
  .choice.wrong{border-color:#e53935}
  .quiz .note{margin-top:8px; font-size:.95rem}

  /* Ø§Ù„Ø³Ø¬Ù„ */
  .log{margin-top:14px; background:var(--white); border:2px dashed var(--green-100);
    border-radius:14px; padding:12px; max-height:220px; overflow:auto}
  .log h3{margin:0 0 8px} .log p{margin:0 0 6px}

  /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… */
  .teacher{
    display:grid; gap:10px; margin-top:12px; border:2px dashed var(--green-200); padding:12px; border-radius:12px;
    background:var(--green-25)
  }
  .teacher .row{display:flex; gap:8px; flex-wrap:wrap}
  input[type="number"],input[type="password"]{
    padding:10px; border:2px solid var(--green-200); border-radius:10px; min-width:120px
  }
  .pin-info{font-size:.9rem; color:#2e7d32}

  /* Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© */
  .game{
    margin-top:16px; border:2px solid var(--green-100); border-radius:14px; padding:14px;
  }
  .grid {display:grid; grid-template-columns: repeat(4, 1fr); gap:10px}
  @media (max-width:620px){ .grid {grid-template-columns: repeat(3, 1fr)} }
  .card-tile{
    background:var(--green-25); border:2px solid var(--green-100); border-radius:12px;
    height:90px; display:grid; place-items:center; font-size:2rem; cursor:pointer;
    user-select:none; transition: transform .1s ease
  }
  .card-tile:hover{transform:translateY(-2px)}
  .card-tile.matched{filter:grayscale(.3); opacity:.6; pointer-events:none}

  .game .bar{
    margin-top:10px; height:8px; background:var(--green-100); border-radius:999px; overflow:hidden
  }
  .game .fill{height:100%; width:0%; background:linear-gradient(90deg,#81c784,#4caf50)}
  .game .top{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
  .stat{font-weight:700}

  /* Ù…ÙÙ†ØªÙ‚Ù Ø¹Ø´ÙˆØ§Ø¦ÙŠ */
  .picker{margin-top:14px; background:var(--white); border:2px dashed var(--green-100); padding:12px; border-radius:12px}
</style>
</head>
<body>
<header>
  <div class="wrap brand" aria-label="Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ">
    <h1>ğŸ¤– Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ØªÙÙˆÙ‚ â€” Ø±ÙˆØ¨ÙˆØª Ø§Ù„ÙØµÙ„</h1>
    <span class="badge">Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ Ø¨Ø·Ù„! Ø§Ù„ÙŠÙˆÙ… ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ ğŸ’«</span>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø±: Ø§Ù„Ø±ÙˆØ¨ÙˆØªØŒ Ø§Ù„Ù†Ù‚Ø§Ø·ØŒ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŒ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <section class="card">
      <!-- Ø§Ù„Ø±ÙˆØ¨ÙˆØª -->
      <div class="bot">
        <div class="bot-avatar" aria-hidden="true">
          <svg viewBox="0 0 64 64" role="img" aria-label="ÙˆØ¬Ù‡ Ø±ÙˆØ¨ÙˆØª">
            <rect x="10" y="18" width="44" height="34" rx="10" fill="#ffffff" />
            <circle cx="26" cy="35" r="5" fill="#81c784"/>
            <circle cx="38" cy="35" r="5" fill="#81c784"/>
            <rect x="22" y="45" width="20" height="4" rx="2" fill="#a9dfb6"/>
            <rect x="30" y="8" width="4" height="10" rx="2" fill="#ffffff"/>
            <circle cx="32" cy="8" r="4" fill="#81c784"/>
          </svg>
        </div>
        <div class="bubble" id="bubble">
          <b>Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ØªÙÙˆÙ‚:</b> Ù…Ø±Ø­Ø¨Ù‹Ø§ ÙŠØ§ Ø¨Ø·Ù„! ğŸ‘‹ Ø¬Ø§Ù‡Ø² Ù†Ø¨Ø¯Ø£ ÙŠÙˆÙ…Ù†Ø§ Ø¨Ø§Ù„Ø­Ù…Ø§Ø³ØŸ
        </div>
      </div>

      <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø¯ÙŠØ« -->
      <div class="actions" aria-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
        <button id="btnGreet">ØªØ±Ø­ÙŠØ¨ Ø¨Ø§Ù„ÙØµÙ„</button>
        <button id="btnTips" class="secondary">Ù†ØµÙŠØ­Ø© Ø³Ø±ÙŠØ¹Ø©</button>
        <button id="btnQuiz" class="ghost">Ø³Ø¤Ø§Ù„ Ø³Ø±ÙŠØ¹ (Ù†Ù‚Ø§Ø·)</button>
        <button id="btnClearLog" class="secondary">ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„</button>
      </div>

      <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù†Ù‚Ø§Ø· -->
      <div class="score" aria-label="Ù„ÙˆØ­Ø© Ø§Ù„Ù†Ù‚Ø§Ø·">
        <div class="pts">Ù†Ù‚Ø§Ø·Ùƒ: <span id="points">0</span></div>
        <div class="progress" aria-label="Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…"><div class="bar" id="bar"></div></div>
        <button id="btnReset" class="ghost" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø·">Ø¥Ø¹Ø§Ø¯Ø©</button>
      </div>

      <!-- Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª -->
      <div class="rewards" aria-label="Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª">
        <div class="reward locked" data-need="5">
          <div class="title">â­ Ù†Ø¬Ù…Ø© Ø§Ù„ØªØ´Ø¬ÙŠØ¹</div>
          <div class="need">ØªØ­ØªØ§Ø¬: 5 Ù†Ù‚Ø§Ø·</div>
        </div>
        <div class="reward locked" data-need="10">
          <div class="title">ğŸ… Ù…Ù„ØµÙ‚ Â«ÙŠØ§ Ø¨Ø·Ù„Â»</div>
          <div class="need">ØªØ­ØªØ§Ø¬: 10 Ù†Ù‚Ø§Ø·</div>
        </div>
        <div class="reward locked" data-need="20">
          <div class="title">ğŸ® Ø§Ø®ØªÙŠØ§Ø± Ù„Ø¹Ø¨Ø© ØµÙÙŠØ©</div>
          <div class="need">ØªØ­ØªØ§Ø¬: 20 Ù†Ù‚Ø·Ø©</div>
        </div>
        <div class="reward locked" data-need="30">
          <div class="title">ğŸ“š ÙˆØ³Ø§Ù… Â«Ø§Ù„Ù‚Ø§Ø±Ø¦ Ø§Ù„ØµØºÙŠØ±Â»</div>
          <div class="need">ØªØ­ØªØ§Ø¬: 30 Ù†Ù‚Ø·Ø©</div>
        </div>
      </div>

      <!-- Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹ -->
      <div class="quiz" id="quizBox" hidden>
        <h3>Ø³Ø¤Ø§Ù„ Ø³Ø±ÙŠØ¹ ÙŠØ§ Ø¨Ø·Ù„ âœ¨</h3>
        <div id="qText">...</div>
        <div class="choices" id="choices"></div>
        <div class="note" id="qNote">Ø£Ø¬Ø¨ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ +2 Ù†Ù‚Ø§Ø·</div>
      </div>

      <!-- Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© -->
      <div class="game" id="gameBox">
        <div class="top">
          <h3 style="margin:0">ğŸ² Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</h3>
          <div class="stat">Ù…Ø­Ø§ÙˆÙ„Ø§Øª: <span id="tries">0</span> | Ø£Ø²ÙˆØ§Ø¬: <span id="pairs">0</span>/8</div>
        </div>
        <div class="grid" id="grid"></div>
        <div class="bar" title="ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©"><div class="fill" id="fill"></div></div>
        <div class="actions" style="margin-top:10px">
          <button id="btnRestart" class="ghost">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>
      </div>

      <!-- Ø§Ù„Ø³Ø¬Ù„ -->
      <div class="log" aria-label="Ø³Ø¬Ù„ Ø­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ¨ÙˆØª">
        <h3>Ø¢Ø®Ø± Ù…Ø§ Ù‚Ø§Ù„Ù‡ Ø§Ù„Ø±ÙˆØ¨ÙˆØª</h3>
        <div id="logArea"></div>
      </div>
    </section>

    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù†: Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… + Ø§Ù„Ù…ÙÙ†ØªÙ‚Ù Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ + Ø¥Ø±Ø´Ø§Ø¯Ø§Øª -->
    <aside class="card">
      <h2 style="margin-top:0">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…</h2>
      <div class="teacher" id="teacherBox">
        <div class="row">
          <input type="password" id="pin" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ: 1234)" />
          <button id="btnUnlock" class="ghost">ÙØªØ­</button>
          <span class="pin-info">* ØªÙ„Ù…ÙŠØ­: Ø§Ù„Ø±Ù…Ø² Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØºÙŠÙŠØ± Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø¯Ù†Ø§Ù‡.</span>
        </div>
        <div class="row" id="controlRow" hidden>
          <button data-delta="1">+1</button>
          <button data-delta="-1" class="warn">âˆ’1</button>
          <button data-delta="5">+5</button>
          <button data-delta="-5" class="warn">âˆ’5</button>
          <input type="number" id="setVal" placeholder="ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø·" />
          <button id="btnSet" class="secondary">ØªØ¹ÙŠÙŠÙ†</button>
          <button id="btnLock" class="ghost">Ù‚ÙÙ„</button>
        </div>
        <div class="row" id="settingsRow" hidden>
          <input type="password" id="pinNew" placeholder="ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ" />
          <button id="btnChangePin" class="secondary">ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù…Ø²</button>
        </div>
      </div>

      <div class="picker">
        <h3 style="margin-top:0">ğŸ¯ Ù…ÙÙ†ØªÙ‚Ù Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
        <div class="row" style="display:flex; gap:8px; align-items:center">
          <input type="number" id="maxStudent" value="30" min="5" max="60" />
          <button id="btnPick">Ø§Ø®ØªØ± Ø±Ù‚Ù…Ù‹Ø§</button>
          <div><b>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±:</b> <span id="picked">â€”</span></div>
        </div>
      </div>

      <hr>
      <h3>Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø³Ø±ÙŠØ¹Ø©</h3>
      <ul style="line-height:2">
        <li>Ø§Ø¨Ø¯Ø£ Ø¨Ù€ Â«ØªØ±Ø­ÙŠØ¨ Ø¨Ø§Ù„ÙØµÙ„Â»Ø› Ø§Ù„Ø±ÙˆØ¨ÙˆØª ÙŠÙ‚ÙˆÙ„: Â«ÙŠØ§ Ø¨Ø·Ù„Â» ÙˆÙŠØ­Ù…Ù‘Ø³ Ø§Ù„Ø·Ù„Ø§Ø¨.</li>
        <li>Ø§Ø³ØªØ®Ø¯Ù… Â«Ø³Ø¤Ø§Ù„ Ø³Ø±ÙŠØ¹Â» ÙˆÂ«Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©Â» Ù„Ù…Ù†Ø­ Ù†Ù‚Ø§Ø· ØªØ´Ø¬ÙŠØ¹ÙŠØ©.</li>
        <li>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… ØªØ³Ù…Ø­ Ø¨Ù…Ù†Ø­/Ø®ØµÙ… ÙˆØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø· (Ø¨Ø±Ù…Ø² Ø¨Ø³ÙŠØ·).</li>
        <li>Ø§Ù„Ù†Ù‚Ø§Ø· ØªÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ (localStorage).</li>
      </ul>
    </aside>
  </div>
</main>

<script>
  // ====== Ø«ÙˆØ§Ø¨Øª ÙˆÙ…Ø±Ø§Ø¬Ø¹ ======
  const LS_POINTS = 'superStudentPoints';
  const LS_PIN    = 'superStudentPIN';
  const DEFAULT_PIN = '1234';
  const MAX_REWARD = 30;

  const bubble = document.getElementById('bubble');
  const pointsEl = document.getElementById('points');
  const bar = document.getElementById('bar');
  const logArea = document.getElementById('logArea');
  const rewards = [...document.querySelectorAll('.reward')];

  const btnGreet = document.getElementById('btnGreet');
  const btnTips = document.getElementById('btnTips');
  const btnQuiz = document.getElementById('btnQuiz');
  const btnReset = document.getElementById('btnReset');
  const btnClearLog = document.getElementById('btnClearLog');

  // Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…
  const pin = document.getElementById('pin');
  const btnUnlock = document.getElementById('btnUnlock');
  const btnLock = document.getElementById('btnLock');
  const controlRow = document.getElementById('controlRow');
  const settingsRow = document.getElementById('settingsRow');
  const setVal = document.getElementById('setVal');
  const btnSet = document.getElementById('btnSet');
  const btnChangePin = document.getElementById('btnChangePin');
  const pinNew = document.getElementById('pinNew');

  // Ø§Ù„Ù…ÙÙ†ØªÙ‚Ù Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
  const maxStudent = document.getElementById('maxStudent');
  const btnPick = document.getElementById('btnPick');
  const picked = document.getElementById('picked');

  // Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
  const quizBox = document.getElementById('quizBox');
  const qText = document.getElementById('qText');
  const choicesEl = document.getElementById('choices');

  // Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
  const grid = document.getElementById('grid');
  const triesEl = document.getElementById('tries');
  const pairsEl = document.getElementById('pairs');
  const fill = document.getElementById('fill');
  const btnRestart = document.getElementById('btnRestart');

  // ====== Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© ======
  function getPoints(){ return parseInt(localStorage.getItem(LS_POINTS) || '0', 10); }
  function setPoints(v){ localStorage.setItem(LS_POINTS, String(Math.max(0,v))); updatePointsUI(); }
  function ensurePIN(){ if(!localStorage.getItem(LS_PIN)) localStorage.setItem(LS_PIN, DEFAULT_PIN); }
  function getPIN(){ ensurePIN(); return localStorage.getItem(LS_PIN); }
  function setPIN(v){ localStorage.setItem(LS_PIN, v); }

  function log(text){
    const p = document.createElement('p');
    p.textContent = 'â€¢ ' + text;
    logArea.prepend(p);
  }

  function setBubble(text){
    bubble.innerHTML = `<b>Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ØªÙÙˆÙ‚:</b> ${text}`;
  }

  // ====== Ø§Ù„ØµÙˆØª (Web Speech API + Ù…Ø¤Ø«Ø±Ø§Øª) ======
  function speak(text){
    try{
      const synth = window.speechSynthesis;
      if (!synth){ setBubble(text); log('Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ….'); return; }
      const utter = new SpeechSynthesisUtterance(text);
      const arVoice = (synth.getVoices() || []).find(v=>/ar|Arabic/i.test(v.lang));
      if (arVoice) utter.voice = arVoice;
      utter.lang = 'ar-SA';
      utter.rate = 1; utter.pitch = 1; utter.volume = 1;
      setBubble(text);
      synth.cancel();
      synth.speak(utter);
    }catch(e){ setBubble(text); }
  }

  // Ù…Ø¤Ø«Ø±Ø§Øª Ù†ØºÙ…ÙŠØ© ØµØºÙŠØ±Ø© Ø¨Ø¯ÙˆÙ† Ù…Ù„ÙØ§Øª (Web Audio API)
  function beep(freq=880, dur=0.12, type='sine'){
    try{
      const ctx = new (window.AudioContext||window.webkitAudioContext)();
      const o = ctx.createOscillator(); const g = ctx.createGain();
      o.type=type; o.frequency.value=freq; o.connect(g); g.connect(ctx.destination);
      g.gain.setValueAtTime(0.0001, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime+0.02);
      o.start();
      setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+dur); o.stop(ctx.currentTime+dur+0.02); }, dur*1000);
    }catch(_){}
  }
  function successFx(){ beep(880,0.1,'triangle'); setTimeout(()=>beep(1320,0.12,'triangle'),110); }
  function errorFx(){ beep(220,0.18,'sawtooth'); }

  // ====== Ø§Ù„Ù†Ù‚Ø§Ø· + Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª ======
  function addPoints(n, reason=''){
    const v = Math.max(0, getPoints() + n);
    localStorage.setItem(LS_POINTS, String(v));
    if(n>0){ speak(`Ø£Ø­Ø³Ù†Øª ÙŠØ§ Ø¨Ø·Ù„! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${n} Ù†Ù‚Ø§Ø·.`); successFx(); }
    else { speak(`Ø³Ù†Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙŠØ§ Ø¨Ø·Ù„.`); errorFx(); }
    log(`${n>0?'+':''}${n} Ù†Ù‚Ø§Ø·. ${reason}`);
    updatePointsUI(true);
  }

  function updatePointsUI(animate=false){
    const v = getPoints();
    pointsEl.textContent = v;
    const pct = Math.min(100, Math.round((v / MAX_REWARD) * 100));
    bar.style.width = pct + '%';
    if (animate){ bar.animate([{width:bar.style.width},{width:bar.style.width}],{duration:250}); }
    rewards.forEach(r=>{
      const need = parseInt(r.dataset.need, 10);
      if (v >= need) r.classList.remove('locked');
      else r.classList.add('locked');
    });
  }

  // ====== Ø±Ø³Ø§Ø¦Ù„ ======
  const tips = [
    'ÙŠØ§ Ø¨Ø·Ù„ØŒ Ù…Ù† ÙŠØ±ÙØ¹ ÙŠØ¯Ù‡ Ø£ÙˆÙ„Ù‹Ø§ ÙŠØ®ØªØ§Ø± Ø§Ù„Ù†Ø´Ø§Ø·! ğŸ‘‹',
    'Ø§Ù„Ø¨Ø·Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ùˆ Ù…Ù† ÙŠØ­Ø§ÙˆÙ„ØŒ Ø­ØªÙ‰ Ù„Ùˆ Ø£Ø®Ø·Ø£. ğŸŒŸ',
    'Ù†Ù‚Ø±Ø£ Ø¨ØµÙˆØª ÙˆØ§Ø¶Ø­ ÙˆÙ†Ø³ØªÙ…Ø¹ Ù„Ø²Ù…Ù„Ø§Ø¦Ù†Ø§. ğŸ“–',
    'Ù†Ø±ØªØ¨ Ø£Ø¯ÙˆØ§ØªÙ†Ø§ ÙˆÙ†Ø¨Ø¯Ø£ Ø¨Ù‡Ø¯ÙˆØ¡. ğŸ§ ',
  ];

  // ====== Ø¨Ù†Ùƒ Ø£Ø³Ø¦Ù„Ø© Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ ======
  const QUESTIONS = [
    { q:'Ù…Ø§ Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø°ÙŠ ÙŠØ³Ø¨Ù‚ Â«Ø¨Â»ØŸ', choices:['Ø§','Øª','Ø¬'], answer:0 },
    { q:'ÙƒÙ… Ù…Ø¬Ù…ÙˆØ¹ 1 + 2 ØŸ', choices:['1','2','3'], answer:2 },
    { q:'Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ø¨Ø­Ø±Ù Ù…: ', choices:['ÙƒØªØ§Ø¨','Ù…Ø¯Ø±Ø³Ø©','Ø¨Ø§Ø¨'], answer:1 },
    { q:'ÙƒÙ… Ø¹Ø¯Ø¯ Ø­Ø±ÙˆÙ ÙƒÙ„Ù…Ø© Â«Ø¨ÙŠØªÂ»ØŸ', choices:['2','3','4'], answer:1 },
    { q:'Ù…Ø§ Ø§Ù„Ø±Ù‚Ù… Ø¨Ø¹Ø¯ 4ØŸ', choices:['3','5','2'], answer:1 },
  ];

  function askQuiz(){
    quizBox.hidden = false;
    const item = QUESTIONS[Math.floor(Math.random()*QUESTIONS.length)];
    qText.textContent = item.q;
    choicesEl.innerHTML = '';
    item.choices.forEach((c,i)=>{
      const btn = document.createElement('button');
      btn.type='button';
      btn.className='choice';
      btn.textContent = c;
      btn.addEventListener('click', ()=>{
        if (i === item.answer){
          btn.classList.add('correct');
          addPoints(2, 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©');
          speak('Ø¥Ø¬Ø§Ø¨Ø© Ø±Ø§Ø¦Ø¹Ø© ÙŠØ§ Ø¨Ø·Ù„! Ù†Ù‚Ø·ØªØ§Ù†!');
        }else{
          btn.classList.add('wrong');
          speak('Ù‚Ø±ÙŠØ¨Ø© ÙŠØ§ Ø¨Ø·Ù„! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
          errorFx();
        }
        [...choicesEl.children].forEach(b=>b.disabled=true);
        setTimeout(()=>{ quizBox.hidden = true; }, 1400);
      });
      choicesEl.appendChild(btn);
    });
  }

  // ====== Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© ======
  const EMOJIS = ['ğŸ','ğŸŒ','ğŸ‡','ğŸ“','ğŸ‰','ğŸ§©','âœï¸','ğŸ“—']; // 8 Ø£Ø²ÙˆØ§Ø¬
  let first=null, second=null, lock=false, tries=0, pairs=0;

  function shuffledPairs(){
    const arr = [...EMOJIS, ...EMOJIS];
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()* (i+1));
      [arr[i],arr[j]] = [arr[j],arr[i]];
    }
    return arr;
  }

  function buildGrid(){
    grid.innerHTML=''; tries=0; pairs=0; updateGameUI();
    first=second=null; lock=false;
    const tiles = shuffledPairs();
    tiles.forEach((emj, idx)=>{
      const tile = document.createElement('div');
      tile.className='card-tile';
      tile.dataset.value = emj;
      tile.dataset.index = idx;
      tile.textContent = 'â“';
      tile.addEventListener('click', ()=> flip(tile));
      grid.appendChild(tile);
    });
  }

  function flip(tile){
    if(lock || tile.classList.contains('matched')) return;
    if(tile.textContent !== 'â“') return; // Ù…ÙØªÙˆØ­Ø© Ø¨Ø§Ù„ÙØ¹Ù„
    tile.textContent = tile.dataset.value;
    if(!first){ first = tile; return; }
    second = tile; lock = true; tries++; updateGameUI();

    if(first.dataset.value === second.dataset.value){
      // ØªØ·Ø§Ø¨Ù‚
      first.classList.add('matched');
      second.classList.add('matched');
      first = second = null; lock=false; pairs++; successFx(); addPoints(1,'Ù…Ø·Ø§Ø¨Ù‚Ø© ØµØ­ÙŠØ­Ø©');
      updateGameUI();
      if(pairs===EMOJIS.length){
        speak('Ø£Ø­Ø³Ù†Øª ÙŠØ§ Ø¨Ø·Ù„! Ø£Ù†Ù‡ÙŠØª Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
        successFx(); successFx();
        // Ù…ÙƒØ§ÙØ£Ø© Ø¥Ø¶Ø§ÙÙŠØ© ØµØºÙŠØ±Ø©
        addPoints(3,'Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©');
      }
    }else{
      // Ø¹Ø¯Ù… ØªØ·Ø§Ø¨Ù‚
      errorFx();
      setTimeout(()=>{
        if(first) first.textContent='â“';
        if(second) second.textContent='â“';
        first=second=null; lock=false;
      }, 700);
    }
  }

  function updateGameUI(){
    triesEl.textContent = String(tries);
    pairsEl.textContent = String(pairs);
    const pct = Math.round((pairs / EMOJIS.length) * 100);
    fill.style.width = pct + '%';
  }

  // ====== Ø§Ù„Ù…ÙÙ†ØªÙ‚Ù Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ ======
  function pickRandom(){
    const max = Math.max(5, Math.min(60, parseInt(maxStudent.value||'30',10)));
    const n = 1 + Math.floor(Math.random()*max);
    picked.textContent = n;
    speak(`ÙŠØ§ Ø¨Ø·Ù„ Ø±Ù‚Ù… ${n}ØŒ Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†!`);
    successFx();
  }

  // ====== Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… (Ø±Ù…Ø² Ø¨Ø³ÙŠØ·) ======
  function unlock(){
    if(pin.value === getPIN()){
      controlRow.hidden = false;
      settingsRow.hidden = false;
      pin.value='';
      speak('ØªÙ… ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù….');
      log('ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù….');
    }else{
      speak('Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­.');
      errorFx();
    }
  }
  function lockPanel(){
    controlRow.hidden = true;
    settingsRow.hidden = true;
    speak('ØªÙ… Ù‚ÙÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù….');
    log('Ù‚ÙÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù….');
  }

  // ====== Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ======
  btnGreet.addEventListener('click', ()=>{ speak('Ù…Ø±Ø­Ø¨Ù‹Ø§ ÙŠØ§ Ø¨Ø·Ù„! Ø£Ù†Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ØªÙÙˆÙ‚. Ø³Ù†Ø¨Ø¯Ø£ Ø¯Ø±Ø³Ù†Ø§ Ø¨Ù†Ø´Ø§Ø· ÙˆØ­Ù…Ø§Ø³ØŒ Ù…Ù† Ù…Ø³ØªØ¹Ø¯Ù‘ØŸ'); log('ØªØ±Ø­ÙŠØ¨ Ø¨Ø§Ù„ÙØµÙ„.'); });
  btnTips.addEventListener('click', ()=>{ const t=tips[Math.floor(Math.random()*tips.length)]; speak(t); log('Ù†ØµÙŠØ­Ø©: '+t); });
  btnQuiz.addEventListener('click', askQuiz);
  btnReset.addEventListener('click', ()=>{ if(confirm('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø·ØŸ')){ setPoints(0); log('ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†.'); }});
  btnClearLog.addEventListener('click', ()=> logArea.innerHTML='');

  // Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…
  btnUnlock.addEventListener('click', unlock);
  btnLock.addEventListener('click', lockPanel);
  document.querySelectorAll('#controlRow button[data-delta]').forEach(b=>{
    b.addEventListener('click', ()=> addPoints(parseInt(b.dataset.delta,10), 'Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…'));
  });
  btnSet.addEventListener('click', ()=>{
    const v = parseInt(setVal.value||'0',10);
    if(isFinite(v)){ setPoints(v); log('ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ '+v); successFx(); }
  });
  btnChangePin.addEventListener('click', ()=>{
    if(!controlRow.hidden && pinNew.value){
      setPIN(pinNew.value);
      pinNew.value='';
      speak('ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù…Ø² Ø¨Ù†Ø¬Ø§Ø­.');
      successFx();
    }
  });

  // Ø§Ù„Ù…ÙÙ†ØªÙ‚Ù
  btnPick.addEventListener('click', pickRandom);

  // Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
  btnRestart.addEventListener('click', ()=>{ buildGrid(); speak('Ø¨Ø¯Ø£Ù†Ø§ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙŠØ§ Ø¨Ø·Ù„.'); });

  // ====== Ø¥Ø·Ù„Ø§Ù‚ Ø£ÙˆÙ„ÙŠ ======
  (function init(){
    ensurePIN();
    if (Number.isNaN(getPoints())) setPoints(0);
    updatePointsUI();
    buildGrid();
    setTimeout(()=> speak('Ù…Ø±Ø­Ø¨Ù‹Ø§ ÙŠØ§ Ø¨Ø·Ù„! Ø¬Ø§Ù‡Ø² Ù†Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù…ØŸ'), 600);
  })();
</script>
</body>
</html>
